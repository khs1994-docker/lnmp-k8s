(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{415:function(t,e,v){"use strict";v.r(e);var s=v(42),a=Object(s.a)({},(function(){var t=this,e=t.$createElement,v=t._self._c||e;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("h1",{attrs:{id:"persistentvolume-持久化卷-pv"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#persistentvolume-持久化卷-pv"}},[t._v("#")]),t._v(" PersistentVolume（持久化卷 PV）")]),t._v(" "),v("ul",[v("li",[v("p",[t._v("https://github.com/kubernetes-retired/external-storage")])]),t._v(" "),v("li",[v("p",[t._v("PV 是 "),v("strong",[t._v("全局")]),t._v(" 的,没有命名空间的概念。")])])]),t._v(" "),v("div",{staticClass:"language-bash extra-class"},[v("pre",{pre:!0,attrs:{class:"language-bash"}},[v("code",[t._v("$ kubectl get storageclass\n")])])]),v("p",[v("code",[t._v("PersistentVolumes")]),t._v(" 可以有多种回收策略，包括 "),v("strong",[t._v("Retain")]),t._v("、"),v("strong",[t._v("Recycle")]),t._v(" 和 "),v("strong",[t._v("Delete")]),t._v("。对于动态配置的 "),v("code",[t._v("PersistentVolumes")]),t._v(" 来说，默认回收策略为 "),v("strong",[t._v("Delete")]),t._v("。这表示当用户删除对应的 "),v("code",[t._v("PersistentVolumeClaim")]),t._v(" 时，动态配置的 volume 将被自动删除。")]),t._v(" "),v("p",[t._v("如果 volume 包含重要数据时，这种自动行为可能是不合适的。那种情况下，更适合使用 "),v("strong",[t._v("Retain")]),t._v(" 策略。使用 "),v("strong",[t._v("Retain")]),t._v(" 时，如果用户删除 "),v("code",[t._v("PVC")]),t._v("，对应的 "),v("code",[t._v("PV")]),t._v(" 不会被删除。相反，它将变为 "),v("strong",[t._v("Released")]),t._v(" 状态，表示所有的数据可以被手动恢复。")]),t._v(" "),v("h2",{attrs:{id:"pv-回收策略"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#pv-回收策略"}},[t._v("#")]),t._v(" PV 回收策略")]),t._v(" "),v("ul",[v("li",[v("p",[v("strong",[t._v("Retain")]),t._v(" 就是保留现场，K8S 什么也不做，允许人工处理保留的数据")])]),t._v(" "),v("li",[v("p",[v("strong",[t._v("Delete")]),t._v(" K8S会自动删除该 PV 及里面的数据")])]),t._v(" "),v("li",[v("p",[v("strong",[t._v("Recycle")]),t._v(" K8S会将 PV 里的数据删除，然后把 PV 的状态变成 Available，又可以被新的 PVC 绑定使用")])]),t._v(" "),v("li",[v("p",[t._v("NFS 和 HostPath 支持回收 "),v("strong",[t._v("Recycle")])])]),t._v(" "),v("li",[v("p",[t._v("AWS、EBS、GCE、PD 和 Cinder 支持删除 "),v("strong",[t._v("Delete")]),t._v("。")])])]),t._v(" "),v("h2",{attrs:{id:"状态位清除"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#状态位清除"}},[t._v("#")]),t._v(" 状态位清除")]),t._v(" "),v("div",{staticClass:"language-bash extra-class"},[v("pre",{pre:!0,attrs:{class:"language-bash"}},[v("code",[t._v("$ kubectl replace -f xxx.yaml "),v("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 定义 PV 的 YAML 文件")]),t._v("\n")])])]),v("h2",{attrs:{id:"tips"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#tips"}},[t._v("#")]),t._v(" Tips")]),t._v(" "),v("ul",[v("li",[v("p",[t._v("静态提供：管理员手动创建多个PV，供PVC使用。")])]),t._v(" "),v("li",[v("p",[t._v("动态提供：动态创建PVC特定的PV，并绑定。")])])]),t._v(" "),v("p",[v("code",[t._v("PVC")]),t._v(" 和 "),v("code",[t._v("PV")]),t._v(" 的绑定，不是简单的通过 "),v("code",[t._v("Label")]),t._v(" 来进行。而是要综合 "),v("code",[t._v("storageClassName")]),t._v(" "),v("code",[t._v("accessModes")]),t._v(" "),v("code",[t._v("matchLabels")]),t._v(" 以及 "),v("code",[t._v("storage")])]),t._v(" "),v("h2",{attrs:{id:"静态创建-pv"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#静态创建-pv"}},[t._v("#")]),t._v(" 静态创建 PV")]),t._v(" "),v("p",[t._v("创建一个 PVC 就必须手动去创建一个 PV")]),t._v(" "),v("h2",{attrs:{id:"动态创建-pv"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#动态创建-pv"}},[t._v("#")]),t._v(" "),v("a",{attrs:{href:"https://kubernetes.io/zh-cn/docs/concepts/storage/dynamic-provisioning/",target:"_blank",rel:"noopener noreferrer"}},[t._v("动态创建 PV"),v("OutboundLink")],1)]),t._v(" "),v("p",[t._v("动态存储卷供应使用 "),v("code",[t._v("StorageClass")]),t._v(" 进行实现，其允许存储卷按需被创建。如果没有动态存储供应，Kubernetes 集群的管理员将不得不通过手工的方式类创建新的存储卷。通过动态存储卷，Kubernetes 将能够按照用户的需要，自动创建其需要的存储。")]),t._v(" "),v("h2",{attrs:{id:"storageclassname"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#storageclassname"}},[t._v("#")]),t._v(" storageClassName")]),t._v(" "),v("p",[t._v("In the past, the annotation "),v("code",[t._v("volume.beta.kubernetes.io/storage-class")]),t._v(" was used instead of the "),v("code",[t._v("storageClassName")]),t._v(" attribute. This annotation is still working; however, it will become fully deprecated in a future Kubernetes release")]),t._v(" "),v("h2",{attrs:{id:"pv-type"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#pv-type"}},[t._v("#")]),t._v(" PV type")]),t._v(" "),v("ul",[v("li",[t._v("https://kubernetes.io/docs/concepts/storage/persistent-volumes/#types-of-persistent-volumes")])]),t._v(" "),v("h2",{attrs:{id:"pv-生命周期"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#pv-生命周期"}},[t._v("#")]),t._v(" PV 生命周期")]),t._v(" "),v("p",[v("code",[t._v("available")]),t._v(" 表示当前的 pv 没有被绑定\n"),v("code",[t._v("bound")]),t._v(" 已经被 pvc 挂载\n"),v("code",[t._v("released")]),t._v(" pvc 没有在使用 pv, 需要管理员手工释放 pv\n"),v("code",[t._v("failed")]),t._v(" 资源回收失败")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("操作")]),t._v(" "),v("th",[t._v("PV状态")]),t._v(" "),v("th",[t._v("PVC状态")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("1. 添加 PV")]),t._v(" "),v("td",[t._v("Available")]),t._v(" "),v("td",[t._v("-")])]),t._v(" "),v("tr",[v("td",[t._v("2. 添加 PVC")]),t._v(" "),v("td",[t._v("Available")]),t._v(" "),v("td",[t._v("Pending")])]),t._v(" "),v("tr",[v("td"),t._v(" "),v("td",[t._v("Bound")]),t._v(" "),v("td",[t._v("Bound")])]),t._v(" "),v("tr",[v("td",[t._v("3. 删除 PV")]),t._v(" "),v("td",[t._v("-")]),t._v(" "),v("td",[t._v("Lost")])]),t._v(" "),v("tr",[v("td",[t._v("4. 再次添加 PV")]),t._v(" "),v("td",[t._v("Bound")]),t._v(" "),v("td",[t._v("Bound")])]),t._v(" "),v("tr",[v("td",[t._v("5. 删除 PVC")]),t._v(" "),v("td",[t._v("Released")]),t._v(" "),v("td",[t._v("-")])]),t._v(" "),v("tr",[v("td",[t._v("6. Storage 不可用")]),t._v(" "),v("td",[t._v("Failed")]),t._v(" "),v("td",[t._v("-")])]),t._v(" "),v("tr",[v("td",[t._v("7. 手动修改PV，删除 ClaimRef")]),t._v(" "),v("td",[t._v("Available")]),t._v(" "),v("td",[t._v("-")])])])]),t._v(" "),v("h2",{attrs:{id:"参考"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),v("ul",[v("li",[t._v("https://www.cnblogs.com/cuishuai/p/9152277.html")]),t._v(" "),v("li",[t._v("https://blog.csdn.net/dkfajsldfsdfsd/article/details/81319735")])])])}),[],!1,null,null,null);e.default=a.exports}}]);